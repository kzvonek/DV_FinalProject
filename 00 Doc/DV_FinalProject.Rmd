---
title: "DV_FinalProject"
author: "ENK"
date: "April 29, 2015"
output: html_document
---
Created by: Natasha Halfin, Evan Johnston, and Kaylyn Zvonek 

```{r, echo=TRUE}
library("ggplot2")
library("gplots")
library("bitops")
library("knitr")
library("jsonlite")
library("ggthemes")
library("RCurl")
library("reshape2")
library("tidyr")
library("dplyr")
library("grid")

source("../01 Data/Data.R")
source("../02 Data Wrangling/DataWrangling.R")
#source("../03 Visualizations/Visualizations.R")
```


For our project, we chose to work with three datasets. One contains data on the top 5000 companies in the U.S., the second contains state employment data, and the third data set describes housing data by state. Our goal was to cover as much material as possible covered in class, including data blending, data joins, beautiful plotting, data wrangling, SQL crosstabs, and advanced table calculations.

Below is a snapshot of the dataframes for each dataset prior to any data manipulation.

Top Companies Data

```{r, eval = TRUE, echo=TRUE}
data.frame(head(dfTOPCOMPANIES))
```

State Employment Data
```{r, eval = TRUE, echo=TRUE}
data.frame(head(dfSTATETOTALS))
```

State Housing Data
```{r, eval = TRUE, echo=TRUE}
data.frame(head(dfSTATEHOUSING))
```


## Data Wranglings

The dataframe below displays a left join between the state employment data and the state housing data based on the key of state. There have also been mutated columns added that represent calculated values based on existing columns, such as Average Employment (AVG_EMP).
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfSTATEHOUSINGTOTALS))
```
**************
This dataframe displays the Top Companies Data grouped by Industry and State, with summarized values indicating average revenue and growth.
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfTopCompanies2))
```
**************

This dataframe the same combination of Top Companies data as the one above,except it is filtered to only show results for Texas companies and industries.
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfTopCompanies3))
```
**************

This dataframe is a left join between a dataframe of the Top Companies data, grouped by state, with dfSTATEHOUSINGTOTALS from above. This displays a wide range of industry, employment, and housing data for each state.
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfTOTALS))

```

****************
The dataframe below utilizes SQL crosstabs by ranking companies within the Top Companies dataset, when partitioned by industry, and ordered by revenue.
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfRANKREVENUE))
```
*************

This dataframe is another ranking SQL crosstab, this time for the housing dataset. Here, we display the ranking of population density by state.
```{r, eval=TRUE, echo=TRUE}
data.frame(head(dfRANKPOPDENSITY))
```
************
## Visualizations in R
***************
## Tableau Visualizations
![](./EmploymentPayState.png)
Employment rate is a calculated field that finds the average employment rate by state by dividing number of employed people by the population. Pay rate is a calculated field that displays the average annual pay by state. It is found by dividing the total payroll for an entire state by the state's number of employees. Size displays the pay rate and color displays the employment rate. The database used is a join of the state housing and state totals tables on state.   

![](./IndustryStateEarnings.png)
Color shows the state that performs best in a given industries. The text shows a given industries percentile contribution to a state with all the industries in one state adding up to 100%. The data used is from the top companies table. 

![](./LandWaterHousing.png)
A dual axis is used to show population density on top of a double bar chart displaying land and water proportions by state. The database used is a join of the state housing and state totals tables on state. 

![](./PopulationvsArea.jpg)
The color shows the total area of a state and the size shows the population of a given state.

![](./CityGrowthNth.png)
The nth parameter is used to show nth growth by city from unique company ids. The color range reflects the lowest to highest growth over all company ids. The top companies table is used.  

